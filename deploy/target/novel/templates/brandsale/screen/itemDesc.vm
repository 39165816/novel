
<!DOCTYPE html>

<html>
    <head>
        <title>品牌特卖商品包装>>>>>$!{brandsaleitemdo.itemTitle}($!{brandsaleitemdo.itemId})</title>
        <meta charset="GBK">
		<link href="http://a.tbcdn.cn/p/mall/base/favicon.ico" rel="icon" type="image/x-icon" />
        <script src="http://g.tbcdn.cn//tm/chn-3c/1.1.9/jquery.js" type="text/javascript" ></script>
        <script src="http://g.tbcdn.cn/tm/chn-3c/1.1.9/ajaxfileupload.js" type="text/javascript"></script>
        
        <style type="text/css">
        	body{
			    font-size:15px;
			    font-family:"宋体";
			}
			
			.btn{padding: 2 4 0 4;font-size:12px;height:23;background-color:#ece9d8;border-width:1;}
			
        </style>
        
        <script type="text/javascript">
		    var jQ=jQuery.noConflict();
			
			
			var defaultUrl = 'http://img01.taobaocdn.com/tps/i1/T1vd42FlpXXXa1mUv5-305-233.png';
			
			jQ.extend({
                handleError: function( s, xhr, status, e ) {
                if ( s.error ){
                   	 s.error( xhr, status, e );
				}else if(xhr.responseText)
               	 	console.log(xhr.responseText);
                }
             });
			 
			 function newUploadPic(imageType,fileEleId,showEleId){
			       var emptyElement = jQ("#" +showEleId+" img[data='']:first");
				   if(emptyElement == undefined || emptyElement.attr("id") == undefined){
				   	    alert("图片上传张数超过最大张数!");
						return;
				   }
				   
        		   jQ.ajaxFileUpload({
        	                url:'imgUpload.htm',
        	                secureuri:false,
        	                fileElementId:fileEleId,//文件上传空间的id属性
        	                dataType: 'text',//返回值类型 一般设置为json
							data: {
                                "imageType": imageType
                            },  
        	                success: function (data, status)  //服务器成功响应处理函数
        	                {
								newHandleUploadPicReturn(data,status,showEleId);
        	                },
        	                error: function (data, status, e)//服务器响应失败处理函数
        	                {
        	                    newHandleUploadPicReturn(data,status,showEleId);
        	                }
        	            }
        	        );
        	 }
			 
			 function newHandleUploadPicReturn(data,status,showEleId){
				var dataJson = jQ.parseJSON(data);
                if(dataJson.success){
				  var emptyElement = jQ("#" +showEleId+" img[data='']:first");
				  emptyElement.attr("src",dataJson.data.url);
				  emptyElement.attr("data",dataJson.data.id);
        	   }else{
                    alert("图片上传失败。失败原因:"+dataJson.errorMsg);
        	   }
			 }
			 
			 function newDeletePic(showEleId){
				   var picKey = jQ("#"+showEleId).attr("data");
				   jQ("#"+showEleId).attr("src",defaultUrl);
				   jQ("#"+showEleId).attr("data","")
				   
				//   if(picKey != undefined && picKey != ""){
    	       //  	   jQ.ajax({
    	       // 			 type:'post',
    	       // 			 url:'item/image.json',
    	      //  			 data:{id:picKey},
    	     //   			 dataType:'json'
    	     //   		})
			//	   }
        	 }
			 
			 function newCaculateCertPic(){
        		 var result = "";
       		  	 jQ("#cert_pic_show  img").each(function(index,element){
       		  		  if(jQ(element).attr("data") != "" && jQ(element).attr("data") != undefined
					  	  && jQ(element).attr("src") != "" && jQ(element).attr("src") != undefined){
						  
   					     var hrefValue = jQ(element).attr("src");
   					     var keyValue =  jQ(element).attr("data");
       		  			  
       		  			  if(result == ""){
       		  				result = "[{\"id\":\"" + keyValue + "\",\"url\":\""+ hrefValue + "\"}";
       		  			  }else{
       		  				result = result  + ","+ "{\"id\":\"" + keyValue + "\",\"url\":\""+ hrefValue + "\"}";
       		  			  }
       		  		  }
       		  	 });
       		  	 if(result == ""){
       		  		return "[]";
       		  	 }else{
	       		  	 return result + "]";
       		  	 }
       	 	 }
			 
			 function newInsertCertPic(certPicUrl,certPicKey){
				if(certPicUrl != undefined && certPicUrl != "" && certPicKey != undefined && certPicKey != ""){
    				var emptyElement = jQ("#cert_pic_show img[data='']:first");
					if(emptyElement.attr("id") != undefined){
        				emptyElement.attr("src",certPicUrl);
        				emptyElement.attr("data",certPicKey);
					}
				}				
			 }
			 
			 function newCaculateAttetionPic(){
			 	 var attentionPicEle = jQ("#attentionPic_1_show");
        		 if(attentionPicEle.attr("data") != "" && attentionPicEle.attr("data") != undefined
				 	&& attentionPicEle.attr("src") != "" && attentionPicEle.attr("src") != undefined){
        			  return "{\"id\": \""+attentionPicEle.attr("data")+"\",\"url\": \""+attentionPicEle.attr("src")+"\"}";
        		 }
        		  return "{}";
			 }
			 
			 function newInsertAttentionPic(attionPicUrl,attentionPicKey){
			 	if(attionPicUrl != undefined && attionPicUrl != "" && attentionPicKey != undefined && attentionPicKey != ""){
    				var emptyElement = jQ("#attention_pic_show img[data='']:first");
					if(emptyElement.attr("id") != undefined){
        				emptyElement.attr("src",attionPicUrl);
        				emptyElement.attr("data",attentionPicKey);
					}
				}
			 }
			 
			 var newGroupIndex = 0;
			 function newInsertPicGroup(name,imgs){
			 	 jQ('#pic_table_show').append(newCreatePicGroupComp(name,imgs));
				 newGroupIndex++;
        	 }
			 
			  function newCreatePicGroupComp(name,imgs){
        		 if(name == undefined){
				 	name = "";
        		 }
        		 var picUrlArr = [];
        		 var picKeyArr = [];
        		 if(imgs != undefined){
        			 var picUrlArr = new Array(imgs.length);
        			 var picKeyArr = new Array(imgs.length);
        			 var index = 0;
	        		 jQ.each(imgs,function(key,value){
						 	picUrlArr[index] = value.url;
						 	picKeyArr[index] = value.id;
						 	index++;
				      });
					  
        		 }
				 
        		 
        		  var newGroup = "<tr id=\"picGroup_"+newGroupIndex+"\" >";
        		  newGroup = newGroup+"<td>";
        		  newGroup = newGroup+"<table  style=\"border:1px solid #000; \">";
        		  newGroup = newGroup+"<tr>";
        		  newGroup = newGroup+"<td>组名称：<input id=\"picGroup_name"+newGroupIndex+"\" type=\"text\"  size=\"20\" value=\""+name+"\"></td>";
				  newGroup = newGroup+"<td><input type=\"file\" name=\"fileData\"  id=\"picGroupPicFile"+newGroupIndex+"\" onchange=\"newUploadPic('p1','picGroupPicFile"+newGroupIndex+"','picGroupShow"+newGroupIndex+"')\"></td>"
				  newGroup = newGroup+"</tr>";
        		 
				  newGroup = newGroup+"<tr>";
        		  newGroup = newGroup+"<td colspan=\"3\" >";
        		  newGroup = newGroup+"<table id=\"picGroupShow"+newGroupIndex+"\" style=\"border:1px;\">";
				  
        		  newGroup = newGroup+"<tr align=\"center\">";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+"<img id=\"picGroup_1_show"+newGroupIndex+"\" width=\"120\" height=\"100\" src=\""+getArrayValue(picUrlArr,0,defaultUrl)+"\" data=\""+getArrayValue(picKeyArr,0)+"\"  onclick=\"showRawPic(this)\" title=\"点击察看原图\" />";
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+"<img id=\"picGroup_2_show"+newGroupIndex+"\" width=\"120\" height=\"100\" src=\""+getArrayValue(picUrlArr,1,defaultUrl)+"\" data=\""+getArrayValue(picKeyArr,1)+"\" onclick=\"showRawPic(this)\" title=\"点击察看原图\" />";
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+"<img id=\"picGroup_3_show"+newGroupIndex+"\" width=\"120\" height=\"100\" src=\""+getArrayValue(picUrlArr,2,defaultUrl)+"\" data=\""+getArrayValue(picKeyArr,2)+"\" onclick=\"showRawPic(this)\" title=\"点击察看原图\" />";
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+"<img id=\"picGroup_4_show"+newGroupIndex+"\" width=\"120\" height=\"100\" src=\""+getArrayValue(picUrlArr,3,defaultUrl)+"\" data=\""+getArrayValue(picKeyArr,3)+"\" onclick=\"showRawPic(this)\" title=\"点击察看原图\" />";
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+"<img id=\"picGroup_5_show"+newGroupIndex+"\" width=\"120\" height=\"100\" src=\""+getArrayValue(picUrlArr,4,defaultUrl)+"\" data=\""+getArrayValue(picKeyArr,4)+"\" onclick=\"showRawPic(this)\" title=\"点击察看原图\" />";
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+"<img id=\"picGroup_6_show"+newGroupIndex+"\" width=\"120\" height=\"100\" src=\""+getArrayValue(picUrlArr,5,defaultUrl)+"\" data=\""+getArrayValue(picKeyArr,5)+"\" onclick=\"showRawPic(this)\" title=\"点击察看原图\" />";
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"</tr>";
				  newGroup = newGroup+"<tr align=\"center\">";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+deleteTD("picGroup_1_show"+newGroupIndex);
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+deleteTD("picGroup_2_show"+newGroupIndex);
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+deleteTD("picGroup_3_show"+newGroupIndex);
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+deleteTD("picGroup_4_show"+newGroupIndex);
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+deleteTD("picGroup_5_show"+newGroupIndex);
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+deleteTD("picGroup_6_show"+newGroupIndex);
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"</tr>";
				  
				  
				   newGroup = newGroup+"<tr align=\"center\">";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+"<img id=\"picGroup_7_show"+newGroupIndex+"\" width=\"120\" height=\"100\" src=\""+getArrayValue(picUrlArr,6,defaultUrl)+"\" data=\""+getArrayValue(picKeyArr,6)+"\" onclick=\"showRawPic(this)\" title=\"点击察看原图\" />";
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+"<img id=\"picGroup_8_show"+newGroupIndex+"\" width=\"120\" height=\"100\" src=\""+getArrayValue(picUrlArr,7,defaultUrl)+"\" data=\""+getArrayValue(picKeyArr,7)+"\" onclick=\"showRawPic(this)\" title=\"点击察看原图\" />";
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+"<img id=\"picGroup_9_show"+newGroupIndex+"\" width=\"120\" height=\"100\" src=\""+getArrayValue(picUrlArr,8,defaultUrl)+"\" data=\""+getArrayValue(picKeyArr,8)+"\" onclick=\"showRawPic(this)\" title=\"点击察看原图\" />";
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+"<img id=\"picGroup_10_show"+newGroupIndex+"\" width=\"120\" height=\"100\" src=\""+getArrayValue(picUrlArr,9,defaultUrl)+"\" data=\""+getArrayValue(picKeyArr,9)+"\" onclick=\"showRawPic(this)\" title=\"点击察看原图\" />";
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+"<img id=\"picGroup_11_show"+newGroupIndex+"\" width=\"120\" height=\"100\" src=\""+getArrayValue(picUrlArr,10,defaultUrl)+"\" data=\""+getArrayValue(picKeyArr,10)+"\" onclick=\"showRawPic(this)\" title=\"点击察看原图\" />";
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+"<img id=\"picGroup_12_show"+newGroupIndex+"\" width=\"120\" height=\"100\" src=\""+getArrayValue(picUrlArr,11,defaultUrl)+"\" data=\""+getArrayValue(picKeyArr,11)+"\" onclick=\"showRawPic(this)\" title=\"点击察看原图\" />";
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"</tr>";
				  newGroup = newGroup+"<tr align=\"center\">";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+deleteTD("picGroup_7_show"+newGroupIndex);
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+deleteTD("picGroup_8_show"+newGroupIndex);
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+deleteTD("picGroup_9_show"+newGroupIndex);
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+deleteTD("picGroup_10_show"+newGroupIndex);
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+deleteTD("picGroup_11_show"+newGroupIndex);
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"<td>";
				  newGroup = newGroup+ deleteTD("picGroup_12_show"+newGroupIndex);
				  newGroup = newGroup+"</td>";
				  newGroup = newGroup+"</tr>";
				  
				  
        		  newGroup = newGroup+"</table>";
        		  newGroup = newGroup+"</td>";
        		  newGroup = newGroup+"</tr>";
				  
				  
				  
        		  newGroup = newGroup+"</table>";
        		  newGroup = newGroup+"</td>";
        		  newGroup = newGroup+"<td>";
        		  newGroup = newGroup+ "<input type=\"button\" class=\"btn\"   value=\"删除组\" onclick=\"newDeletePicGroup("+newGroupIndex+")\">";
        		  newGroup = newGroup+"</td>";
        		  newGroup = newGroup+"</tr>";
        		  return newGroup;
        	 }
			 
			 function deleteTD(id){
			 	return "<a href=\"javascript:void(0)\" onclick=\"newDeletePic('"+id+"')\">删除</a>";
			 }
			 
			 function getArrayValue(arr,index,defaultValue){
			 	if(arr[index] == undefined){
					if(defaultValue != undefined){
						return defaultValue;
					}else{
    					return "";
					}
				}
			 	return arr[index];
			 }
			 
			 
			 function newCaculatePicGroup(){
        		 var jsonResult = ""
        		 
 				 jQ("#pic_table_show  tr[id^='picGroup_']").each(function(index,element){
        			 var groupName = jQ("#" +jQ(element).attr("id")+ " input[id^='picGroup_name']:first").val();
        			 
        			 var picUrls = "";
					 
        			 jQ("#" +jQ(element).attr("id")+ " img").each(function(index,innerElement){
        				 if(jQ(innerElement).attr("data") != "" && jQ(innerElement).attr("data") != undefined
						 	&& jQ(innerElement).attr("src") != "" && jQ(innerElement).attr("src") != undefined){
        					 var hrefValue =  jQ(innerElement).attr("src");
        					 var keyValue =  jQ(innerElement).attr("data");
        					 
        					 if(picUrls == ""){
	        					 picUrls = "[{\"id\":\"" + keyValue + "\",\"url\":\""+ hrefValue + "\"}";
        					 }else{
	        					 picUrls = picUrls  + ","+ "{\"id\":\"" + keyValue + "\",\"url\":\""+ hrefValue + "\"}";
        					 }
        				 }
        			 });
					 if(picUrls == ""){
					 	picUrls = "[";
					 }
        			 picUrls = picUrls + "]";
        			 
        			 if(jsonResult == ""){
	        			 jsonResult = jsonResult + "[{\"name\":\"" +groupName+"\",\"imgs\":"+picUrls + "}"
        			 }else{
        				 jsonResult = jsonResult + ",{\"name\":\"" +groupName+"\",\"imgs\":"+picUrls + "}"
        			 }
 				});
	        			 
        		 if(jsonResult == ""){
        		  	return "[]";
        		 }else{
 	       		  	 return jsonResult + "]";
        		 }
        	 }
			 
			 
			 function newDeletePicGroup(baseGroupIndex){
        		 var basePicGroup = jQ('#picGroup_'+baseGroupIndex);
        		 basePicGroup.remove();
        	 }
			 
		
        	 function insertSizeTableLine(lineValue){
        		 var viewStyle = ""
            	 var uploadStyle = ""
           		 if(lineValue == undefined || jQ.trim(lineValue) == "" || jQ.trim(lineValue) == "[]"){
           			 viewStyle = "display:none";
					 lineValue = "";
           		 }else{
           			 uploadStyle = "display:none";
           		 }
        		 
        		 var eleId = "sizeTableData";
          		 var result = "<td width=\"100%\" id=\"fileUpload_"+eleId+"\" style=\""+uploadStyle+"\">"
	    		   result = result + "<input type=\"file\" id=\"uploadFile_"+eleId+"\" name=\"fileData\"  onchange=\"uploadFile('"+eleId+"')\">"
	    		   result = result + "</td>"
	    		   result = result + "<td width=\"100%\" id=\"fileView_"+eleId+"\"  style=\""+viewStyle+"\">"
	    		   result = result + "<div id=\"sizeTableDataShow\">" + parseTableSizeData(lineValue) + "</div>" ;
	    		   result = result + "<input  type=\"button\" value=\"删除\" onClick=\"deleteFile('"+eleId+"')\">"
	    		   result = result + "<input id=\"fileData_"+eleId+"\" type=\"hidden\" value=\'"+lineValue+"\'>"
	    		   result = result + "</td>"
	    		   result = result + "<td width=\"100%\" id=\"transition_"+eleId+"\"  style=\"display:none\">"
	    		   result = result + "文件上传中，请稍后..."
	    		   result = result + "</td>"
	    		   
	    		   
	    		   jQ('#size_table').append("<tr>"+result+"</tr>"); 	 
        	 }
        	 
        	function deleteFile(eleId){
        		   jQ('#fileUpload_'+eleId).show();
         	        jQ('#fileData_'+eleId).val("");
         	       jQ('#sizeTableDataShow').html("");
         	       jQ('#fileView_'+eleId).hide();
                   jQ('#transition_'+eleId).hide();
        	}
        	
        	function parseTableSizeData(lineValue){
        		 if(lineValue == undefined || lineValue == ""){
        			 return "";
        		 }
        		 lineValue = jQ.parseJSON(lineValue);
        		 
        		 var result = "";
        		 for(var index = 0;index<lineValue.length;index++){
        			 result = result + lineValue[index] + "</br>"
        		 }
        		return  result;
        	}
        	
        	function handleUploadFileResult(eleId,data,status){
        		  if(data.success){
                         jQ('#fileData_'+eleId).val(data.obj);
                         jQ('#sizeTableDataShow').html( parseTableSizeData(data.data)) ;
                  	     jQ('#fileView_'+eleId).show();
                         jQ('#transition_'+eleId).hide();
                         jQ('#fileData_sizeTableData').val(data.data);
              	   }else{
              	        jQ('#fileUpload_'+eleId).show();
              	        jQ('#fileData_'+eleId).val("");
                        jQ('#transition_'+eleId).hide();
                        jQ('#sizeTableDataShow').html("") ;
                        jQ('#fileData_sizeTableData').val("");
                        alert("尺码表上传失败："+data.errorMsg);
              	   }
        	}
        	
        	function uploadFile(eleId){
        		 jQ('#fileView_'+eleId).hide();
       		     jQ('#fileUpload_'+eleId).hide();
                 jQ('#transition_'+eleId).show();
                 jQ('#fileData_'+eleId).val("");
                 
       		    jQ.ajaxFileUpload({
       		    		url:'excelUpload.htm',
       	                secureuri:false,
       	                fileElementId:'uploadFile_'+eleId,//文件上传空间的id属性  <input type="file" id="file" name="file" />
       	                dataType: 'json',//返回值类型 一般设置为json
       	                success: function (data, status)  //服务器成功响应处理函数
       	                {
       	                	handleUploadFileResult(eleId,data, status);
       	                },
       	                error: function (data, status, e)//服务器响应失败处理函数
       	                {
       	                	handleUploadFileResult(eleId,data, status);
       	                }
       	            }
       	        );
        	}
        	 
        	 function caculateSizeTable(){
        		var result = jQ("#fileData_sizeTableData").val();
        		if(result == ""){
        			return "[]";
        		}else{
        			return result;
        		}
        		
        	 }
			 
			  function handleSaveReturn(data,status){
			        jQ('#saveBtn').removeAttr("disabled"); 
			        if(data.success){
						alert("包装信息保存成功。");
					}else{
						alert("包装信息保存失败。"+data.errorMsg);
					}
			  	
			 }
        	 
        	 function doSave(){
			 	if(!confirm("确实要保存本次的修改内容吗?")){
					return;
			 	}
			 
			    jQ('#saveBtn').attr('disabled',"true");
			 
        		var certPic = newCaculateCertPic();
        		var attentionPic = newCaculateAttetionPic();
        		var picGroup =  newCaculatePicGroup();
        		var sizeTable = caculateSizeTable();
        		jQ.ajax({
        			 type:'post',
        			 url:'item/item.json?_input_charset=utf-8&sessionKey=$!sessionKey',
        			 data:{qualityReport:certPic,instruction:attentionPic,itemImage:picGroup,itemSize:sizeTable,itemId:'$!itemId'},
        			 dataType:'json',
        			 success:function(data, status){
        				 	handleSaveReturn(data, status);
        			 },
        			 error:function(){
					 		handleSaveReturn(data, status);
        			 }
        		 })
        	 }
        	 
        	 function isExpired(){
        	 	#if("$!sessionExpired" == "true")
					return true;
				#else
					return false;
				#end
        	 }
        	 
        	 function isItemDataError(){
        	 	#if("$!itemDataError" == "true")
					return true;
				#else
					return false;
				#end
        	 }
        	 
        	 
        	 
        	 function init(){
			 	 jQ('#saveBtn').attr('disabled',"true");
			 	 jQ('#submitAuditBtn').attr('disabled',"true");
				 
				 if(isExpired()){
				 	alert("登陆信息已过期，请重新登陆!");
					return;
				 }
				 if(isItemDataError()){
				 	alert("宝贝数据存在错误，请与管理员联系!");
					return;
				 }
				 var itemId = '$!itemId';
				 
				 if(itemId == ''){
				 	alert("请输入正确的宝贝ID");
				 	return;
				 }
			 
        		 jQ.ajax({
        			 type:'post',
        			 url:'json/itemQuery.htm?id='+itemId,
        			 dataType:'json',
        			 success:function(data, status){
					     data = data.data;
        				 if(data.itemSize != null && data.itemSize != undefined){
        				 	insertSizeTableLine(data.itemSize);
        				 }else{
        					 insertSizeTableLine();
        				 }
        				 
        				 if(data.itemImage != null && data.itemImage != undefined){
							 jQ.each(jQ.parseJSON(data.itemImage),function(key,value){
									newInsertPicGroup(value.name,value.imgs);
							 });
						 }
						 
						 if(data.instruction != null && data.instruction != undefined){
						     var instructionJson = jQ.parseJSON(data.instruction)
							 newInsertAttentionPic(instructionJson.url,instructionJson.id);
						 }
						 
						 
						 if(data.qualityReport != null && data.qualityReport != undefined){
							 jQ.each(jQ.parseJSON(data.qualityReport),function(key,value){
							     newInsertCertPic(value.url,value.id);
							 });
						 }
						 
						 #if($!canEdit == false)
						 	viewModule();
						 #end
						 
						 jQ('#saveBtn').removeAttr("disabled"); 
						 jQ('#submitAuditBtn').removeAttr('disabled');
        			 },
        			 error:function(){
        				   alert("获取包装信息失败");
        			 }
        		 })
        	 }
        	 
        	 function viewModule(){
        	 	jQ("#itemdesc_table input[type='button']").each(function(key,value){
        	 		jQ(value).hide();
        	 	});
        	 	jQ("#itemdesc_table input[type='file']").each(function(key,value){
        	 		jQ(value).hide();
        	 	});
				jQ("#itemdesc_table a").each(function(key,value){
        	 		jQ(value).hide();
        	 	});
				jQ("#itemdesc_table input[type='text']").each(function(key,value){
        	 		jQ(value).attr('disabled',"true");
        	 	});
        	 }
        	 
        	 function doSubmitAudit(){
        	 	jQ('#saveBtn').attr('disabled',"true");
			 	jQ('#submitAuditBtn').attr('disabled',"true");
			 	
			 	var isOkToSubmit = true;
			 	if(!confirm("确认要提交当前包装进行审核吗?")){
			 		isOkToSubmit = false;
			 	}
			 	
			 	var certPic = newCaculateCertPic();
        		var attentionPic = newCaculateAttetionPic();
        		var picGroup =  newCaculatePicGroup();
        		var sizeTable = caculateSizeTable();
        		jQ.ajax({
        			 type:'post',
        			 url:'item/item.json?_input_charset=utf-8&sessionKey=$!sessionKey',
        			 data:{qualityReport:certPic,instruction:attentionPic,itemImage:picGroup,itemSize:sizeTable,itemId:'$!itemId'},
        			 dataType:'json',
        			 success:function(data, status){
					        if(!data.success){
								alert("包装信息保存失败。"+data.errorMsg);
								isOkToSubmit = false;
							}else{
								jQ.ajax({
                        	 		 type:'post',
                        			 url:'item/audit.json?action=submit&sessionKey=$!sessionKey&itemId=$!itemId',
                        			 dataType:'json',
                        			 success:function(data, status){
										if(data.success){
                            				viewModule();
                            			    alert("包装信息提交成功！");
										}else{
										    alert("包装信息提交失败。"+data.errorMsg);
										}
                        			 },
                        			 error:function(){
                        			 	alert("包装信息提交失败，请稍后再试！");
                        			 }
                        	 	});
							}
        			 },
        			 error:function(){
					        if(!data.success){
								alert("包装信息保存失败。"+data.errorMsg);
								isOkToSubmit = false;
							}else{
								jQ.ajax({
                        	 		 type:'post',
                        			 url:'item/audit.json?action=submit&sessionKey=$!sessionKey&itemId=$!itemId',
                        			 dataType:'json',
                        			 success:function(data, status){
                        				if(data.success){
                            				viewModule();
                            			    alert("包装信息提交成功！");
										}else{
										    alert("包装信息提交失败。"+data.errorMsg);
										}
                        			    alert("包装信息提交成功！");
                        			 },
                        			 error:function(){
                        			 	alert("包装信息提交失败，请稍后再试！");
                        			 }
                        	 	});
							}
        			 }
        		 });
        	 	
        	 	jQ('#saveBtn').removeAttr("disabled"); 
				jQ('#submitAuditBtn').removeAttr('disabled');
        	 }
        	 
        	 function doAudit(action){
        	 	jQ('#saveBtn').attr('disabled',"true");
			 	jQ('#auditApproveBtn').attr('disabled',"true");
			 	jQ('#auditRejectBtn').attr('disabled',"true");
			 	
			 	var auditMsg = "";
			 	var isOkToSubmit = true;
			 	
			 	if(action == "reject"){
			 		auditMsg = window.showModalDialog("/brandsale/auditMsg.htm","","dialogWidth=770px;dialogHeight=370px;menubar=no;location=no;status=no;toolbar=no");
			 		if(auditMsg == undefined || jQ.trim(auditMsg) == ""){
			 			alert("请输入审核不通过的原因");
			 			isOkToSubmit = false;
			 		}
			 	}
			 	
			 	
			 	if(isOkToSubmit){
	        	 	jQ.ajax({
	        	 		 type:'post',
	        			 url:'item/audit.json?_input_charset=utf-8&sessionKey=$!sessionKey&action='+action+'&itemId=$!itemId',
	        			 dataType:'json',
	        			 data: {auditMsg: auditMsg},
	        			 success:function(data, status){
						    if(data.success){
								alert("保存操作成功！");
	        			    	jQ('#auditApproveBtn').hide();
	        			    	jQ('#auditRejectBtn').hide();
							}else{
								alert("保存操作失败。"+data.errorMsg);
							}
	        			 },
	        			 error:function(){
	        			 	alert("保存操作失败，请稍后再试！");
	        			 }
	        	 	});
			 	}
        	 	jQ('#saveBtn').removeAttr("disabled"); 
				jQ('#auditApproveBtn').removeAttr('disabled');
			 	jQ('#auditRejectBtn').removeAttr('disabled');
        	 }
			 
			 
			 function showRawPic(imgEle){
			 	window.open(jQ(imgEle).attr("src"));
			 }
        </script>
        
    </head>
    <body onload="init()" >
    	<table id="itemdesc_table"  width="600"  align="center">
    		<tr height="50" align="center">
    			<td  bgcolor="#F18741"><h2>品牌特卖商品详情上传<h2/></td>
    		</tr>
			
			#if("$!auditRecord" != "")
    			<tr>
    				<td>
    					审核记录:
    				</td>
    			</tr>
    			<tr>
    				<td>
    					$!securityUtil.ignoretext($!auditRecord)
    				</td>
    			</tr>
			#end
			
    		<tr>
    			<td  >
    				<table width="900" >
    					  <tr><td>
    					  	<fieldset>
								    <legend><font style="font-weight:bold;">尺码表</font></legend>
								     <table>
								         <tr>
								         	<td><font style="color: #7777DD;">操作提示：将尺码表填入Excel后，上传到系统中。最大行数【20】行；最大列数【14】列；内容字数【1-10】个。</font><font style="color: red;">如您的宝贝有尺码，必须上传尺码表。(Excel单元格格式请使用文字类型)</font></font></td>
								         </tr>
								     </table>
								     </BR>
								     <table  id="size_table"></table>
								  </fieldset>
    					  </td></tr>
    				</table>
    			</td>
    		</tr>
    		<tr>
    			<td>
    				<table width="900" >
    					  <tr><td>
    					        <fieldset>
    					        <legend><font style="font-weight:bold;">细节图</font><font color="red">*</font></legend>
								     <table>
								         <tr>
								         	<td><font style="color: #7777DD;font:normal 12px">操作提示：图片组名称字数要求【1-3】字,</font><font style="color: red;font:normal 12px">必须设置成有意义的名称，如：模特图，细节图，实物图等；</font><font style="color: #7777DD;font:normal 12px">图片尺寸要求【800*800】；每组图片张数要求【1-12】张。</font></td>
								         </tr>
								     </table>
								     </BR>
								     <table  id="pic_table">
											<tr>
												<td width="60%">
													<input type="button" value="添加图片组" onclick="newInsertPicGroup()">
												</td>
											</tr>
									 </table>
								 	  <table  id="pic_table_show" width="100%">
									 </table>
								  </fieldset>
    					  </td></tr>
    				</table>
    			</td>
    		</tr>
    		<tr>
    			<td>
    				<table  width="900" >
    					  <tr><td>
    					  	      <fieldset>
    					  	           <legend><font style="font-weight:bold;">注意事项</font><font color="red">*</font></legend>
    					               	<table>
								         <tr>
								         		<td><font style="color: #7777DD;">操作提示：上传注意事项图片。规范：图片尺寸要求【990*197】。</font></td>
								         </tr>
									     </table>
									     </BR>
									     <table  id="attention_pic_table" width="100%">
											 <tr>
												<td width="2%"></td>
												<td><input type="file" name="fileData" id="attentionPicFile" onchange="newUploadPic('p2','attentionPicFile','attention_pic_show')"></td>
											</tr>
										 </table>
										  <table  id="attention_pic_show" width="200">
											<tr>
												<td align="center">
													<img id="attentionPic_1_show" width="120" height="100" src="http://img01.taobaocdn.com/tps/i1/T1vd42FlpXXXa1mUv5-305-233.png" data="" onclick="showRawPic(this)" title="点击察看原图"/>
												</td>
											</tr>
											<tr>
												<td align="center">
													<a href="javascript:void(0)" onclick="newDeletePic('attentionPic_1_show')">删除</a>
												</td>
											</tr>
										 </table>
								  </fieldset>
    					  </td></tr>
    				</table>
    			</td>
    		</tr>
    		<tr>
    			<td>
    				<table width="900" >
    					  <tr><td>
    					  	      <fieldset>
    					  	      <legend><font style="font-weight:bold;">质检材料</font></legend>
								  	<table>
								         <tr>
								         	<td><font style="color: #7777DD;">操作提示：按张分别上传质检材料图片。规范：图片尺寸要求【235*310】;图片张数要求【0-4】张。</font></td>
								         </tr>
									     </table>
									     </BR>
									     <table  id="cert_pic_table">
											<tr>
												<td width="2%"></td>
												<td><input type="file" name="fileData" id="certPicFile" onchange="newUploadPic('p3','certPicFile','cert_pic_show')"></td>
												<td>
												</td>
											</tr>
										 </table>
										  <table  id="cert_pic_show" width="100%">
											<tr align="center">
												<td>
													<img id="certPic_1_show" width="120" height="100" src="http://img01.taobaocdn.com/tps/i1/T1vd42FlpXXXa1mUv5-305-233.png" data="" onclick="showRawPic(this)" title="点击察看原图"/>
												</td>
												<td>
													<img id="certPic_2_show" width="100" height="100" src="http://img01.taobaocdn.com/tps/i1/T1vd42FlpXXXa1mUv5-305-233.png" data="" onclick="showRawPic(this)" title="点击察看原图"/>
												</td>
												<td>
													<img id="certPic_3_show" width="100" height="100" src="http://img01.taobaocdn.com/tps/i1/T1vd42FlpXXXa1mUv5-305-233.png" data="" onclick="showRawPic(this)" title="点击察看原图"/>
												</td>
												<td>
													<img id="certPic_4_show" width="100" height="100" src="http://img01.taobaocdn.com/tps/i1/T1vd42FlpXXXa1mUv5-305-233.png" data="" onclick="showRawPic(this)" title="点击察看原图"/>
												</td>
											</tr>
											<tr align="center">
												<td>
													<a href="javascript:void(0)" onclick="newDeletePic('certPic_1_show')">删除</a>
												</td>
												<td>
													<a href="javascript:void(0)" onclick="newDeletePic('certPic_2_show')">删除</a>
												</td>
												<td>
													<a href="javascript:void(0)" onclick="newDeletePic('certPic_3_show')">删除</a>
												</td>
												<td>
													<a href="javascript:void(0)" onclick="newDeletePic('certPic_4_show')">删除</a>
												</td>
											</tr>
										 </table>
								  </fieldset>
    					  </td></tr>
    				</table>
    			</td>
    		</tr>
    		<tr height="30" width="900"  align="center">
    			<td bgcolor="#F18741">
    				<input id="saveBtn" class="btn" type="button" value="保存" onclick="doSave()">
    				#if($!canAudit)
	    				<input id="auditApproveBtn" class="btn" type="button" value="审核通过" onclick="doAudit('approve')">
	    			#end
	    			#if($!canRejectAudit)
	    				<input id="auditRejectBtn" class="btn" type="button" value="审核不通过" onclick="doAudit('reject')">
	    			#end
	    			#if($!canSubmitAudit)
	    				<input id="submitAuditBtn" class="btn" type="button" value="保存并提交审核" onclick="doSubmitAudit()">
	    			#end
	    			<a href="$!temaiDetailUrl?id=$!{brandsaleitemdo.itemId}&temai_status=1" target="_blank">预览</a>
    			</td>
    		</tr>
    	</table>
    </body>
</html>